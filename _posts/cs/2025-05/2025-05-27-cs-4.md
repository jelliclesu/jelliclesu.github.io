---
title: "[CS] 트랜잭션과 무결성: 무결성 (Integrity)"
date: 2025-05-27 12:40:30 +0900
categories: [CS, 데이터베이스]
tags: [TIL, CS, 트랜잭션과 무결성]
---
# CS 4장 데이터베이스
## 📚 4.3 트랜잭션과 무결성

### 4.3.2 무결성 (Integrity)

#### 📘 정의
- 데이터베이스 안의 데이터가 **정확**하고 **일관**되며 **유효**하도록 보장하는 **제약조건**의 총제

---

#### 📌 종류
##### ⭐️ **개체 무결성**
- 기본 키는 NULL 불가 + 유일해야 함

```sql
CREATE TABLE users (
  id INT PRIMARY KEY,  -- NOT NULL + UNIQUE
  name VARCHAR(50)
);
```

--

##### ⭐️ **도메인 무결성**
- 속성은 지정된 데이터 형식, 범위만 허용

```sql
CREATE TABLE product (
  price INT CHECK (price >= 0),  -- 음수 불가
category ENUM('ELECTRONICS', 'BOOK', 'FOOD')
);
```

--

##### ⭐️ **참조 무결성**
- 외래 키는 반드시 다른 테이블의 존재하는 값만 참조 가능

```sql
CREATE TABLE orders (
                      id INT PRIMARY KEY,
                      user_id INT,
                      FOREIGN KEY (user_id) REFERENCES users(id)
);
```
- `user_id` 가 없는 사용자는 삽입 불가

--

##### ⭐️ **사용자 정의 무결성**
- 실제 서비스의 비즈니스 규칙 반영

```sql
CHECK (salary >= 0 AND salary < 10000000)
CHECK (discount <= price)
```

---

#### ⚠️ 무결성 위반 시 생기는 문제
- **개체 무결성 위반**: 기본 키 NULL 값으로 **레코드를 유일하게 식별할 수 없음**
- **도메인 무결성 위반**: 생년 월일에 문자 입력 등 **잘못된 데이터 형식 입력** 가능성
- **참조 무결성 위반**: 존재하지 않는 사용자에게 주문이 생성되는 등 **참조 오류 발생**
- **사용자 정의 무결성 위반**: 재고 수량이 음수가 되는 등 **비즈니스 규칙 위반**

---

#### 💻 Java/Spring 예시

```java
@Entity
public class User {

    @Id  // 개체 무결성
    private Long id;

    @Column(nullable = false)  // 도메인 무결성
    private String name;

    @Column(unique = true)     // 도메인 무결성
    private String email;

    @ManyToOne
    @JoinColumn(name = "team_id", foreignKey = @ForeignKey(name = "fk_team"))  // 참조 무결성
    private Team team;
}

```

---

#### 🎤 면접 예상 질문
1. 무결성이란 무엇인가요?
   - 데이터의 일관성과 정합성을 보장하기 위한 제약조건입니다.
   - 개체 무결성, 도메인 무결성, 참조 무결성, 사용자 정의 무결성 등이 있습니다.
2. 외래 키가 무결성을 보장하는 방식은?
   - 외래 키는 참조 대상이 존재하지 않으면 삽입/수정이 차단되며,
   - 삭제 시에도 ON DELETE 옵션으로 연관 행 처리를 강제할 수 있어
   - 테이블 간 관계의 정합성을 자동으로 유지해줍니다.
3. 무결성과 트랜잭션은 어떻게 관련되어 있나요?
   - 무결성은 데이터의 유효성을 보장하고,
   - 트랜잭션은 작업 단위의 원자성을 보장하여
   - 트랜잭션 내에서 무결성을 어기는 작업이 발생하면 전체 롤백되어 정합성을 유지합니다.
