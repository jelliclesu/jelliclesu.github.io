---
title: "[CS] 조인의 원리: 해시 조인 (Hash Join)"
date: 2025-05-30 12:22:22 +0900
categories: [CS, 데이터베이스]
tags: [TIL, CS, 조인의 원리]
---
# CS 4장 데이터베이스
## 📚 4.7 조인의 원리

### 4.7.3 해시 조인 (Hash Join)

#### 📘 정의
- 조인 대상 테이블 중 작은 테이블의 조인 키를 해시 테이블에 저장하고,
- 큰 테이블의 조인 키로 해시 테이블을 탐색하여 매칭하는 조인 방식

< 작동 원리 >
1. **Build** 단계: 작은 테이블의 조인 키 기준으로 해시 테이블 생성
2. **Probe** 단계: 큰 테이블에서 각 행의 조인 키를 해시 테이블에서 탐색
   
➔ **조인 키가 일치하면 결과로 출력**

---

#### 📌 예시 상황
- 조인 대상 중 하나가 상대적으로 작고, 인덱스가 없을 때
- 대용량 데이터 조인 시 빠른 탐색이 필요한 경우

[ SQL 예시 ]

```sql
SELECT *
FROM orders o
       JOIN customers c ON o.customer_id = c.id;
```

- `customers` 테이블이 작고 인덱스가 없다면,
  - ➔ DBMS 는 `customers` 에 대해 해시 테이블 생성하여 `orders` 와 비교 (자동 최적화)

---

#### 🎯 사용 이유 / 장점
- 빠른 탐색 성능 - 해시 기반 탐색으로 **O(1) 에 가까운 속도**
- **인덱스 없이도 빠른 조인** - 사전 정렬 불필요
- **대용량 데이터 조인**에 유리 - 특히 중간 크기 이상의 테이블에 효과적

---

#### ⚠️ 단점
- **메모리 사용 큼** - 해시 테이블을 메모리에 생성하므로 공간 필요
- **해시 충돌 가능성** - 충돌 시 별도 처리 필요해 성능 저하 가능성
- **조인 키가 많은 중복값**을 가지면 비효율적

---

#### 🏢 실무 사용 여부
✔️ PostgreSQL, Oracle, SQL Server 등에서 사용 가능

- MySQL 은 8.0 부터 Blocked Nested Loop Join  + Batched Key Access 등으로 해시 조인 유사 기능 제공
- 조인 대상 크기, 인덱스 유무, 옵티마이저 판단에 따라 자동 선택

---

#### 💻 작동 흐름

```plaintext
# Build Phase
for row in small_table:
    hash_table[hash(row.key)] = row

# Probe Phase
for row in large_table:
    if hash(row.key) in hash_table:
        join row with hash_table[hash(row.key)]
```

---

#### 🎤 면접 예상 질문
1. 해시 조인이란 무엇인가요?
   - 두 테이블을 조인할 때, 작은 테이블의 조인 키를 해시 테이블에 저장하고 큰 테이블에서 키를 해시로 조회하여 매칭하는 조인 방식입니다.
   - 인덱스 없이도 효율적인 조인이 가능하며, 대용량 데이터 처리에 유리한 방식입니다.
2. 정렬 병합 조인과의 차이는?
   - 해시 조인은 정렬이 불필요하고, 인덱스 없이도 빠르다는 장점이 있습니다.
   - 반면, 정렬 병합 조인은 정렬이 필수적으로 필요하여 정렬 비용이 들지만, 예측이 가능하다는 장점이 있습니다.
3. 어떤 상황에서 사용하면 좋나요?
   - 조인 대상 테이블 중 하나가 작고, 조인 키에 인덱스가 없거나 중복이 적은 경우에 사용하면 좋습니다.
   - 이럴 땐 정렬보다 해시 탐색이 더 빠르기 때문입니다.
