---
title: "[CS] 트랜잭션과 무결성: 트랜잭션 (Transaction)"
date: 2025-05-27 12:19:30 +0900
categories: [CS, 데이터베이스]
tags: [TIL, CS]
---
# CS 4장 데이터베이스
## 📚 4.3 트랜잭션과 무결성

### 4.3.1 트랜잭션 (Transaction)

#### 📘 정의
- 데이터베이스에서 **논리적으로 하나의 작업 단위**로 실행되는 연산의 묶음
- 여러 SQL 명령을 하나로 묶어, **모두 성공**하거나 **모두 실패**하도록 보장

---

#### 📌 예시 상황

- 은행 계좌 이체: A 계좌에서 출금해서 B 계좌로 입금
  - ➔ 출금 성공 + 입금 실패 ? 돈이 사라짐!!
  - ➡︎ 반드시 둘을 하나의 작업으로 묶어야 함 = 트랜잭션 처리

---

#### ⭐️ 속성
##### **ACID** 
> 트랜잭션이 갖춰야 할 4가지 핵심 속성

| 속성                | 설명                                 | 키워드            |
|-------------------|------------------------------------|----------------|
| **Atomicity** (**원자성**)   | 전부 성공하거나 전부 실패해야 함                 | All or Nothing |
| **Consistency** (**일관성**) | 작업 전후 상태가 논리적으로 유지되어야 함            | 상태 유지          |
| **Isolation** (**격리성**)   | 동시에 실행되는 트랜잭션 간 간섭이 차단되어야 함        | 충돌 방지          |
| **Durability** (**지속성**)  | 성공한 트랜잭션은 시스템 장애가 발생해도 반드시 반영되어야 함 | 보존             |

---

#### 🎯 트랜잭션 상태

1. **Active**: 실행 중
2. **Partially Committed**: 마지막 명령 실행 완료
3. **Committed**: 성공적으로 완료되어 DB 에 반영
4. **Failed**: 수행 중 오류 발생
5. **Aborted**: 롤백 후 복구 상태

---

#### ⚠️ 트랜잭션이 없을 시 문제점
- **데이터 불일치**: 일부만 반영되어 정합성 붕괴
- **이중 처리**: 중복 저장, 중복 인출 등
- **동시성 충돌**: 두 명이 동시에 같은 자원 접근

---

#### 🏢 SQL 명령어

1. `BEGIN` or `START TRANSACTION`: 트랜잭션 시작
2. `COMMIT`: 변경사항 확정
3. `ROLLBACK`: 변경사항 취소

---

#### 💻 Java/Spring 예시

[JPA 예시 - 입출금]

```java
@Transactional
public void transfer(User from, User to, int amount) {
  from.withdraw(amount); // 출금
  to.deposit(amount);    // 입금
  userRepository.save(from);
  userRepository.save(to);
}
```

- `@Transactional`: 메서드 전체가 하나의 트랜잭션으로 동작하게 함
  - 하나라도 실패 시 자동으로 Rollback

---

#### 🎤 면접 예상 질문
1. 트랜잭션이란?
   - 데이터베이스에서 하나의 작업 단위로 실행되는 연산의 묶음으로,
   - 모두 성공하거나 모두 실패하도록 보장되는 구조로, ACID 속성을 만족해야 합니다.
2. 롤백이란?
   - 트랜잭션 도중 오류가 발생하면, 지금까지 변경된 모든 내용을 이전 상태로 되돌리는 작업을 말합니다.
   - 롤백을 통해 데이터 정합성을 유지합니다.
3. Spring 에서 트랜잭션 구현하는 방법은?
   - `@Transactional` 어노테이이션을 메소드 단위로 달면,
   - 해당 메소드의 실행을 트랜잭션 단위로 처리하게 만듭니다.
   - 내부에서 예외가 발생하면 자동으로 롤백 처리되며, DB 에 안정적으로 반영되도록 도와줍니다.
