---
title: "[CS] 조인의 원리: 정렬 병합 조인 (Sort-Merge Join)"
date: 2025-05-30 12:22:22 +0900
categories: [CS, 데이터베이스]
tags: [TIL, CS, 조인의 원리]
---
# CS 4장 데이터베이스
## 📚 4.7 조인의 원리

### 4.7.2 정렬 병합 조인 (Sort-Merge Join)

#### 📘 정의
- 두 테이블을 **정렬**한 후, **포인터를 움직이면서 순차적으로 비교**하여 매칭되는 값을 **병합**하는 조인 방식

< 작동 순서 >
1. 양쪽 테이블을 조인 키 기준으로 정렬
2. 포인터를 앞에서부터 한줄씩 이동하며 비교
3. 값이 일치하면 결과에 포함 ➔ 다음 값으로 이동

---

#### 📌 예시 상황

- 두 테이블 A, B 모두 조인 키가 **정렬되어 있거나 인덱스가 존재**할 때
- 특히 **중간 크기 이상 테이블** 간 조인 시 효과적

[ SQL 예시 ]

```java
SELECT *
FROM orders o
JOIN customers c ON o.customer_id = c.id
ORDER BY o.customer_id;
```
- `orders`, `customer` 가 `customer_id` 로 정렬되어 있다면 정렬 없이 바로 병합 가능!!

---

#### 🎯 사용 이유 / 장점
- 예측 가능한 성능 - 데이터가 정렬되어 있다면 효율적
- 인덱스 없어도 사용 가능 - 정렬을 수행한 뒤 병합
- 균형 잡힌 데이터에 적합 - 양쪽 테이블의 데이터 크기가 비슷할 때 유리

---

#### ⚠️ 단점
- 정렬 비용 - 조인 전에 정렬이 필요하면 추가 리소스 발생
- 편향된 데이터에 부적합 - 한 쪽 테이블이 너무 클 경우 효율 저하

---

#### 🏢 실무 사용 여부
✔️ **PostgreSQL**, **Oracle** 등에서 테이블 간 정렬된 조인 키가 있을 경우 자동 적용

- MySQL 은 중첩 루프 조인을 기본으로 사용하지만, 옵티마이저가 필요 시 선택 가능
- 정렬된 데이터 구조 or ORDER BY 절 + 조인 환경에서 유용


---

#### 💻 실행 흐름

```plaintext
1. A 와 B 테이블을 조인 키 기준으로 정렬
2. A[i] 와 B[j] 를 비교
3. 같으면 결과에 추가하고 i++, j++
4. 다르면 더 작은 쪽 포인터만 증가
```

---

#### 🎤 면접 예상 질문
1. 정렬 병합 조인이란 무엇인가요?
   - 두 테이블을 조인 키 기준으로 정렬한 뒤, 각 행을 순차적으로 비교하며 매칭된 데이터를 병합하는 방식입니다.
   - 중간 규모 이상의 테이블 간 조인에서 효율적이며, 정렬이 되어 있거나 인덱스가 존재할 경우 성능이 매우 좋습니다.
2. 어떤 상황에서 정렬 병합 조인을 사용하나요?
   - 양쪽 테이블 모두 정렬되어 있거나 인덱스가 있는 경우, 두 테이블의 데이터 크기가 비슷한 경우, 중첩 루프 조인보다 더 나은 성능이 필요한 경우에 사용합니다.
3. 정렬 병합 조인의 단점은?
   - 정렬되어있지 않은 경우, 정렬 비용이 추가로 들어가며,
   - 한쪽 테이블의 크기가 너무 크면 오히려 성능이 떨어질 수 있습니다.
