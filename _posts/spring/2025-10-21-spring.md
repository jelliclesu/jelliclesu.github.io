---
title: "[Spring] JPA ddl-auto 옵션"
date: 2025-10-21 17:22:56 +0900
categories: [Spring, 매일메일]
tags: [TIL, Spring]
---

## JPA ddl-auto 옵션

> Spring Boot에서 Hibernate와 같은 JPA 구현체를 사용할 때,
데이터베이스 **스키마 생성 및 변경 방식을 제어하는 설정**

   
- 설정 위치:
  - `application.properties` 또는 `application.yml`

  Ex) application.yml

  ```yaml
    spring:
      jpa:
        hibernate:
          ddl-auto: update
  ```


---

### 옵션별 동작 방식

`none`

- 데이터베이스 스키마와 연관된 어떠한 작업도 수행하지 않음
- 수동으로 관리하고 싶을 때 유용
- 운영 환경에서 주로 사용

`validate`

- 애플리케이션이 시작될 때, 엔티티 매핑이 데이터베이스 스키마와 일지하는지 검증
- 스키마 변경은 수행하지 않음
- 운영 환경에서 엔티티와 데이터베이스 스키마가 일치하는지 확인하고 싶을 때 사용

`update`

- 엔티티 매핑과 데이터베이스 스키마를 비교하여 필요한 경우 스키마 업데이트
- 기존 데이터 유지되지만, 새로운 엔티티나 변경된 엔티티 필드는 스키마에 반영
- 엔티티에 변경이 발생할 때, 자동으로 스키마 업데이트가 필요할 때 유용
- 운영 환경에서는 주의 필요

`create`

- 애플리케이션이 시작될 때 기존 스키마를 삭제하고 새로 생성
- 데이터가 모두 삭제되며 엔티티 매핑을 기반으로 새로운 스키마 생성
- 개발 초기에 빈 데이터베이스 스키마를 반복적으로 생성해야할 때 유용
- 운영 환경에서 사용하지 않음

`create-drop`

- 애플리케이션이 시작될 때 기존 스키마를 삭제하고 새로 생성한 후, 종료될 때 스키마 삭제
- 테스트 환경에서 일시적인 데이터베이스 스키마가 필요한 경우 유용
- 매 테스트 실행 시마다 깨끗한 데이터베이스상태 유지하고자 할 때 사용
- 운영 환경에서 사용하지 않음

---

### 동작 방식 정리표

| **옵션** | **동작 설명** | **주요 특징** | **권장 환경** |
| --- | --- | --- | --- |
| none | 아무런 스키마 작업도 수행하지 않음 | DB 스키마를 수동으로 관리할 때 사용 | 운영 환경 |
| validate | 엔티티 매핑과 실제 DB 스키마가 일치하는지 검증만 수행 | 불일치 시 예외 발생 / 스키마 수정 없음 | 운영 환경 (검증용) |
| update | 엔티티와 DB 스키마 비교 후, 필요한 변경 자동 반영 | 기존 데이터 유지 / 컬럼 추가·수정 자동 반영 | 개발·테스트용, 운영 시 주의 |
| create | 기존 스키마 삭제 후 새로 생성 | 모든 데이터 삭제 / 매번 초기화 | 개발 초기 |
| create-drop | 애플리케이션 시작 시 스키마 생성, 종료 시 스키마 삭제 | 테스트 후 자동 정리 / 매번 깨끗한 DB 유지 | 테스트 환경 |

---

### 운영 환경에서 스키마 변경은?

- **스키마 자동 변경 옵션(update, create, create-drop) 절대 사용하지 않음!**

  → 자동 변경으로 인해 데이터 손실, 무결성 문제, 배포 실패 등의 위험


안전한 방법:

- 마이크레이션 도구 사용
  - Flyway 또는 Liquibase 등 사용하여 제어된 방식으로 스키마 관리
  - 버전별 SQL 스크립트로 변경 이력 관리 및 자동화 가능
- 스키마 변경 시기 제어
  - 사용자 트래픽이 적은 새벽 시간대에 배포 및 스키마 변경 수행
  - CI/CD 파이프라인과 연동해 DB 스키마 변경 자동화 가능
