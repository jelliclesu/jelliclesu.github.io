---
title: "[Spring] 로그(Log) & 메트릭(Metric)"
date: 2025-11-07 18:39:02 +0900
categories: [매일메일, Spring]
tags: [TIL, Spring]
---
## 로그 (Log)

### 정의

> 애플리케이션, 서버, 또는 시스템이 동작하는 동안 발생한
**상태, 이벤트, 오류, 요청 정보 등을 시간순으로 기록한 데이터**
>

- 문맥(Context) 기반 정보로, 특정 시점에 무엇이, 왜 발생했는지 추적하는 데 용이
- 주로 문제 발생 시 원인 분석(트러블 슈팅)을 위해 활용

### 예시

```
2025-10-30 14:12:45 [INFO] User 123 login success
2025-10-30 14:12:46 [ERROR] Payment API Timeout
```

### 특징

| 항목 | 설명 |
| --- | --- |
| **기록 단위** | 개별 이벤트(요청, 예외, 상태 변화 등) |
| **형태** | 텍스트 기반, 시점 중심 |
| **주요 목적** | 오류 원인 파악, 요청 추적, 디버깅 |
| **저장 수명** | 보통 단기 보관 (1~14일 등) |
| **예시 툴** | Logback, Log4j2, Loki, ELK(Elasticsearch + Logstash + Kibana) |

### 로그 수집: Logback + MDC + Loki

- Logback: Spring Boot 기본 로깅 프레임워크
- MDC(Mapped Diagnostic Context): 요청 단위 추적을 위한 Context ID 추가

  → 로그 상에서 **요청 단위 흐름**을 쉽게 파악 가능

- Loki: 로그를 중앙집중식으로 저장, Grafana 와 통합해 시각화

  →ex) “최근 5분동안 ERROR 로그 발생 추이” 대시보드 표시


#### Logback 설정 예시

```xml
<pattern>
  %d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %X{traceId} %logger{36} - %msg%n
</pattern>
```

---

## 메트릭 (Metric)

### 정의

> 시스템의 **상태, 성능, 자원 사용량 등을 정량적인 수치로 표현한 통계적 지표 데이터**
>

- 현재 시스템이 어떤 상태인지, 현재의 흐름과 경향성을 보여줌

### 예시

| **분류** | **지표 예시** | **수집 이유** |
| --- | --- | --- |
| **시스템 리소스** | CPU 사용률, 메모리 사용량, 디스크 I/O | 서버의 과부하나 리소스 병목 현상을 조기에 감지하여 장애를 예방하고, 성능 저하 원인을 분석하기 위함 |
| **JVM 상태** | 힙 메모리, GC 횟수, 스레드 개수 | 애플리케이션의 메모리 누수나 GC(가비지 컬렉션) 병목, 스레드 과다 생성 등 JVM 내부의 안정성을 확인하기 위함 |
| **애플리케이션 성능** | 요청 처리 속도, 에러율, TPS(Transactions Per Second) | 사용자의 요청을 처리하는 성능을 측정하고, 응답 지연·에러율 증가 등으로 인한 서비스 품질 저하를 조기 감지하기 위함 |
| **비즈니스 지표** | DAU(Daily Active Users), Retention, 결제 성공률 | 단순 기술 성능뿐 아니라 실제 비즈니스 성과(유저 활동·매출 지표)를 추적하여 서비스 개선 방향을 파악하기 위함 |
| **에러 로그 메트릭** | ERROR 레벨 로그 발생 수, 예외 발생 빈도, API 실패율 | 예외 발생 추이와 특정 기능의 실패율을 수치화하여 장애 징후를 조기에 인식하고, 로그 분석의 기준 데이터로 활용하기 위함 |
| **스레드/커넥션 풀 상태** | 톰캣 스레드 풀 사용률, HikariCP 커넥션 풀 대기 수, 활성 커넥션 수 | 요청이 몰릴 때 스레드나 DB 커넥션이 부족해지는 현상을 모니터링하여, 리소스 풀 설정을 최적화하고 응답 지연을 방지하기 위함 |

---

## 로그와 메트릭 비교

| 구분 | 로그(Log) | 메트릭(Metric) |
| --- | --- | --- |
| **데이터 형태** | 비정형 텍스트 | 정형 숫자 (시계열) |
| **기록 시점** | 이벤트 발생 시마다 | 일정 주기 (예: 5초, 30초 단위) |
| **목적** | 원인 분석, 요청 추적 | 시스템 모니터링, 경향 분석 |
| **저장 기간** | 단기 (며칠 단위) | 장기 (주·월 단위) |
| **분석 방식** | 개별 로그 분석 | 평균, 합계, 퍼센트 등 집계 분석 |
| **대표 도구** | Logback, ELK, Loki | Prometheus, Grafana, CloudWatch |

> 로그: 무엇이, 왜 일어났는가 (What + Why)

> 메트릭: 지금 어떤 상태인가 (How Well)

---

## 실무 예시

### 로그 & 메트릭 통합 수집 환경

```
[Spring Boot App]
   ├─(메트릭)─>  Actuator (/actuator/prometheus)
   │               │
   │               └─(pull/scrape)─> Prometheus ──> Grafana(메트릭 대시보드)
   │
   └─(로그)─> Logback/Log4j2 ──> Promtail ──(push)─> Loki ──> Grafana(로그 탐색)
```

- **Spring Boot Actuator**: `/actuator/metrics`, `/actuator/health` 엔드포인트로 메트릭 제공
- **Prometheus**: Spring Boot에서 노출한 메트릭을 주기적으로 스크래핑하여 수집
- **Grafana**: Prometheus 데이터를 기반으로 대시보드 시각화
- **Logback + Loki**: 로그 파일을 Loki 로 전송하고, Grafana에서 로그와 메트릭을 함께 모니터링

### `System.out.println` 대신 로깅 프레임워크 쓰는 이유

| 구분 | `System.out.println` | 로깅 프레임워크(Logback, Log4j2 등) |
| --- | --- | --- |
| **성능** | 즉시 출력 (I/O 부하 발생) | 비동기 처리 가능, 버퍼링 처리 |
| **로그 레벨** | 불가능 | `TRACE`, `DEBUG`, `INFO`, `WARN`, `ERROR` 지원 |
| **환경별 필터링** | 불가능 | dev/test/prod 환경별 로그 수준 조절 |
| **출력 위치** | 콘솔만 가능 | 콘솔 + 파일 + 원격 서버(Loki, ELK 등) |
| **운영 적합성** | 단순 테스트용 | 운영환경 필수 구성요소 |

- `System.out.println` 은 개발 중 디버깅 용도로만 사용
- 운영 환경에서는 반드시**로깅 프레임워크(Logback, Log4j2 등)** 사용

---

참고: [maeil-mail 매일메일 - 로그와 메트릭을 설명해주세요.](https://www.maeil-mail.kr/question/66)
